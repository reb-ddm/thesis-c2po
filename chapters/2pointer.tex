\chapter{2-Pointer Logic}


The abstract domain of the \cpo\ analysis consists of finite conjunctions of propositions from the 2-Pointer Logic.
In the following section, we describe this logic and how to represent the propositions in order to
infer also all deriving propositions.
It was first introduced by Seidl et al.\ in~\cite{2pointer} and was later extended with an additional type of proposition.
The propositions are made up of terms, formed from address constants and auxiliaries using the addition of constant offsets and dereferencing.
The address constants represent addresses of program variables.
The auxiliaries are variables whose address is never taken, therefore
we know of these variables that their address cannot be reached from other terms using address arithmetic or dereferencing.
Only terms whose C type is a pointer type are considered by the analysis.
Let $\X$,$\A$ be disjoint finite sets of variables names and auxiliaries.
The terms $t$ are defined by the following grammar:

\[
    t\,{::=}\,A \mid \&x \mid *(z+t)
\]
where $A\in \A$ is an auxiliary, $x \in \X$ is a variable with address $\&x$ and $z \in \Z$ is an integer.
We call terms $\&x$ or $A$ \emph{atoms}.
Given a linear order $<$ on atoms, it can be extended to an order on terms by defining:
\todo{do i need this?}
\begin{itemize}
    \item $a < *(z+t)$ whenever $a$ is an atom and
    \item $*(z_1 + t_1) < *(z_2 + t_2)$ whenever either $t_1 < t_2$ or $t_1 \equiv t_2$ and $z_1 < z_2$.
\end{itemize}

The terms can form three types of propositions: equalities and disequalities between terms and additionally a proposition which states that two terms do not belong to the same address block.
The propositions $p$ are defined by the following grammar:

\[
    p\,{::=}\,t_1=z+t_2 \mid t_1\neq z+t_2\mid bl(t_1) \neq bl(t_2)
\]

Where $*$ denotes the dereferencing operator and $bl(t)$ represents the address block of $t$.
We use $*t$ as an abbreviation for $*(0+t)$ and $x$ as an abbreviation for $*(0+\&x)$.
For a conjunction $\Psi$ of propositions, we denote the conjunctions of all the equalities in $\Psi$ by $\Psi_{=}$, the conjunction of disequalities between terms by $\Psi_{\neq}$ and the set of block disequalities of the type $bl(t_1) \neq bl(t_2)$ by $\Psi_{bl}$.

\section{Semantics}

We model the memory as a two-dimensional address space $\ZZ$,
where the first element of the address is the \emph{block identifier} and the second element is the \emph{offset} within the block.
Each call to \malloc\ returns an address with a fresh block identifier, and each variable is written in memory in a unique memory block,
which is distinct from the block of any other variable.

The semantics can be described by the following three functions:
\begin{itemize}
\item $\rho : \X \rightarrow \ZZ$ assigns an address to each variable,
\item $\nu : \mathcal{A} \rightarrow \ZZ$ assigns an address to each auxiliary, and
\item $\mu : \ZZ \rightarrow \ZZ$ assigns a value to each address.
\end{itemize}
We are only interested in analyzing the values of pointers and addresses, therefore we interpret each value stored in the memory and in the auxiliaries as an address.

We also define the operator $(+) : \Z \rightarrow \ZZ \rightarrow \ZZ$ on addresses, where $z + (a,b) = (a, z+b)$.
Here, $z$ is added to the address offset, thus modeling the fact that it's not possible to leave a memory block using address arithmetic.
Moreover, we define the function $bl : \ZZ \rightarrow \Z$ that returns the address block identifier of an address, where $bl(a,b) = a$.

A term $t$ is interpreted as the value $\sem{t}(\rho, \nu, \mu)$ defined by:
\[
  \begin{array}{lll}
    \sem{\& x}\,(\rho,\nu,\mu)   & = & \rho\,x                          \\
    \sem{A}\,(\rho,\nu,\mu)      & = & \nu\,A                           \\
    \sem{*(z+t)}\,(\rho,\nu,\mu) & = & \mu\,(z+\sem{t}\,(\rho,\nu,\mu)) \\
  \end{array}
\]

The validity is defined as:
\[
  \begin{array}{ll}
    (\rho,\nu,\mu)\models t_1 = z+t_2          & \textbf{iff}
    \\ \multicolumn{2}{c}{\quad\quad\quad\quad\sem{t_1}\,(\rho,\nu,\mu) = z+\sem{t_2}\,(\rho,\nu,\mu)}	\\
    (\rho,\nu,\mu)\models t_1 \neq z+t_2       & \textbf{iff}
    \\ \multicolumn{2}{c}{\quad\quad\quad\quad\sem{t_1}\,(\rho,\nu,\mu) \neq z+\sem{t_2}\,(\rho,\nu,\mu)}	\\
    (\rho,\nu,\mu)\models bl(t_1) \neq bl(t_2) & \textbf{iff}
    \\ \multicolumn{2}{c}{\quad\quad\quad\quad bl(\sem{t_1}\,(\rho, \nu, \mu)) \neq bl(\sem{t_2}\,(\rho, \nu, \mu))}
  \end{array}
\]

If $(\rho, \nu, \mu)\models p$ for each proposition $p$ in $\Psi$, then we say that $(\rho, \nu, \mu) \models \Psi$. The domain of 2-Pointer Logic $\mathcal{P}_2[=]$ consists of all finite conjunctions
of propositions over terms up to semantic equivalence.
The concretization $\gamma(\Psi)$ of $\Psi$ is the set of all $(\rho, \nu, \mu)$ with $(\rho, \nu, \mu) \models \Psi$.


\input{content/representation}
\input{content/qcc}
\input{content/diseqs}
